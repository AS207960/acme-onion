<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Automated Certificate Management Environment (ACME) Extensions for ".onion" Special-Use Domain Names</title>
<meta content="Q Misell" name="author">
<meta content='
       The document defines extensions to the Automated Certificate Management Environment (ACME) to allow for the
        automatic issuance of certificates to Tor hidden services (".onion" Special-Use Domain Names). 
    ' name="description">
<meta content="xml2rfc 3.18.1" name="generator">
<meta content="draft-ietf-acme-onion-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.1
    Python 3.11.5
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.11.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.8
-->
<link href="draft-ietf-acme-onion.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl > dt {
  float: left;
  margin-right: 1em;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: 14.5px;
}
.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 8em !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">ACME for .onion</td>
<td class="right">October 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Misell</td>
<td class="center">Expires 15 April 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Automated Certificate Management Environment</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-acme-onion-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-10-13" class="published">13 October 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-04-15">15 April 2024</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Q. Misell, <span class="editor">Ed.</span>
</div>
<div class="org">AS207960</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Automated Certificate Management Environment (ACME) Extensions for ".onion" Special-Use Domain Names</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The document defines extensions to the Automated Certificate Management Environment (ACME) to allow for the
        automatic issuance of certificates to Tor hidden services (".onion" Special-Use Domain Names).<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion">
<a href="#name-discussion" class="section-name selfRef">Discussion</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/AS207960/acme-onion">https://github.com/AS207960/acme-onion</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">The project website and a reference implementation can be found at
        <span><a href="https://acmeforonions.org">https://acmeforonions.org</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 15 April 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-requirements-language" class="internal xref">Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-identifier" class="internal xref">Identifier</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-identifier-validation-chall" class="internal xref">Identifier Validation Challenges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-existing-challenges" class="internal xref">Existing challenges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-existing-dns-01-challenge" class="internal xref">Existing "dns-01" Challenge</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.  <a href="#name-existing-http-01-challenge" class="internal xref">Existing "http-01" Challenge</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="auto internal xref">3.1.3</a>.  <a href="#name-existing-tls-alpn-01-challe" class="internal xref">Existing "tls-alpn-01" Challenge</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-new-onion-csr-01-challenge" class="internal xref">New "onion-csr-01" Challenge</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-client-authentication-to-hi" class="internal xref">Client authentication to hidden services</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-acme-over-hidden-services" class="internal xref">ACME over hidden services</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-certification-authority-aut" class="internal xref">Certification Authority Authorization (CAA)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-relevant-resource-record-se" class="internal xref">Relevant Resource Record Set</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-when-to-check-caa" class="internal xref">When to check CAA</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-preventing-mis-issuance-by-" class="internal xref">Preventing mis-issuance by unknown CAs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-alternative-in-band-present" class="internal xref">Alternative in-band presentation of CAA</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="auto internal xref">6.4.1</a>.  <a href="#name-cas-requiring-in-band-caa" class="internal xref">CAs requiring in-band CAA</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="auto internal xref">6.4.2</a>.  <a href="#name-example-in-band-caa" class="internal xref">Example in-band CAA</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-validation-methods" class="internal xref">Validation Methods</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-error-types" class="internal xref">Error Types</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-directory-metadata-fields" class="internal xref">Directory Metadata Fields</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-use-of-dns-identifier-type" class="internal xref">Use of "dns" identifier type</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="auto internal xref">8.1.1</a>.  <a href="#name-http-01-challenge" class="internal xref">"http-01" Challenge</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="auto internal xref">8.1.2</a>.  <a href="#name-tls-alpn-01-challenge" class="internal xref">"tls-alpn-01" Challenge</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="auto internal xref">8.1.3</a>.  <a href="#name-dns-01-challenge" class="internal xref">"dns-01" Challenge</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-key-authorization-with-onio" class="internal xref">Key Authorization with "onion-csr-01"</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-use-of-tor-for-non-onion-do" class="internal xref">Use of Tor for non ".onion" domains</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-security-of-caa-records" class="internal xref">Security of CAA records</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-access-of-the-tor-network" class="internal xref">Access of the Tor network</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-anonymity-of-the-acme-clien" class="internal xref">Anonymity of the ACME client</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-discussion-on-the-use-of-th" class="internal xref">Discussion on the use of the "dns" identifier type</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Tor network has the ability to host "Onion Services" <span>[<a href="#tor-rend-spec-v3" class="cite xref">tor-rend-spec-v3</a>]</span>
        <span>[<a href="#tor-address-spec" class="cite xref">tor-address-spec</a>]</span> only accessible via the Tor network. These use the ".onion"
        Special-Use Domain Name <span>[<a href="#RFC7686" class="cite xref">RFC7686</a>]</span> to identify these services. These can be used as any other domain
        name could, but do not form part of the DNS infrastructure.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The Automated Certificate Management Environment (ACME) <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> defines challenges for
        validating control of DNS identifiers, and whilst a ".onion" Special-Use Domain Name may appear as a DNS name,
        it requires special consideration to validate control of one such that ACME could be used on ".onion"
        Special-Use Domain Names.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">In order to allow ACME to be utilised to issue certificates to ".onion" Special-Use Domain Names this document
        specifies challenges suitable to validate control of these Special-Use Domain Names. Additionally this document
        defines an alternative to the DNS Certification Authority Authorization (CAA) Resource Record
        <span>[<a href="#RFC8659" class="cite xref">RFC8659</a>]</span> that can be used with ".onion" Special-Use Domain Names.<a href="#section-1-3" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words <span class="bcp14">MUST</span>, <span class="bcp14">MUST NOT</span>, <span class="bcp14">REQUIRED</span>, <span class="bcp14">SHALL</span>,
          <span class="bcp14">SHALL NOT</span>, <span class="bcp14">SHOULD</span>, <span class="bcp14">SHOULD NOT</span>, <span class="bcp14">RECOMMENDED</span>,
          <span class="bcp14">NOT RECOMMENDED</span>, <span class="bcp14">MAY</span>, and <span class="bcp14">OPTIONAL</span> in this document are to be
          interpreted as described in <span>[<a href="#BCP14" class="cite xref">BCP14</a>]</span> when, and only when, they appear in all capitals,
          as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-2">
      <h2 id="name-identifier">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-identifier" class="section-name selfRef">Identifier</a>
      </h2>
<p id="section-2-1"><span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> defines the "dns" identifier type. This identifier type <span class="bcp14">MUST</span> be used
        when requesting a certificate for a ".onion" Special-Use Domain Name. The value of identifier
        <span class="bcp14">MUST</span> be the textual representation as defined in <span>[<a href="#tor-address-spec" class="cite xref">tor-address-spec</a>]</span> §3. The value
        <span class="bcp14">MAY</span> include subdomain labels. Version 2 addresses <span class="bcp14">MUST NOT</span> be used as these are
        now considered insecure.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Example identifiers:<a href="#section-2-2" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-2-3">
<pre>
{
  "type": "dns",
  "value": "bbcweb3hytmzhn5d532owbu6oqadra5z3ar726vq5kgwwn6aucdccrad.onion"
}
</pre><a href="#section-2-3" class="pilcrow">¶</a>
</div>
<div class="lang-json sourcecode" id="section-2-4">
<pre>
{
  "type": "dns",
  "value": "www.bbcweb3hytmzhn5d532owbu6oqadra5z3ar726vq5kgwwn6aucdccrad.onion"
}
</pre><a href="#section-2-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-3">
      <h2 id="name-identifier-validation-chall">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-identifier-validation-chall" class="section-name selfRef">Identifier Validation Challenges</a>
      </h2>
<p id="section-3-1">The CA/Browser Forum Baseline Requirements <span>[<a href="#cabf-br" class="cite xref">cabf-br</a>]</span> §B.2 define methods accepted by
        the CA industry for validation of ".onion" Special-Use Domain Names. This document incorporates these methods
        into ACME challenges.<a href="#section-3-1" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-existing-challenges">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-existing-challenges" class="section-name selfRef">Existing challenges</a>
        </h3>
<section id="section-3.1.1">
          <h4 id="name-existing-dns-01-challenge">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-existing-dns-01-challenge" class="section-name selfRef">Existing "dns-01" Challenge</a>
          </h4>
<p id="section-3.1.1-1">The existing "dns-01" challenge <span class="bcp14">MUST NOT</span> be used to validate ".onion" Special-Use Domain
            Names.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.1.2">
          <h4 id="name-existing-http-01-challenge">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-existing-http-01-challenge" class="section-name selfRef">Existing "http-01" Challenge</a>
          </h4>
<p id="section-3.1.2-1">The "http-01" challenge is defined as in <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §8.3 may be used to validate a ".onion"
            Special-Use Domain Names, with the modifications defined in this standard.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.1.2-2">The ACME server <span class="bcp14">SHOULD</span> follow redirects; note that these may be redirects to non ".onion"
            services, and the server <span class="bcp14">SHOULD</span> honour these.<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
</section>
<section id="section-3.1.3">
          <h4 id="name-existing-tls-alpn-01-challe">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-existing-tls-alpn-01-challe" class="section-name selfRef">Existing "tls-alpn-01" Challenge</a>
          </h4>
<p id="section-3.1.3-1">The "tls-alpn-01" challenge is defined as in <span>[<a href="#RFC8737" class="cite xref">RFC8737</a>]</span> may be used to validate a ".onion"
            Special-Use Domain Names, with the modifications defined in this standard.<a href="#section-3.1.3-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-3.2">
        <h3 id="name-new-onion-csr-01-challenge">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-new-onion-csr-01-challenge" class="section-name selfRef">New "onion-csr-01" Challenge</a>
        </h3>
<p id="section-3.2-1">The two methods already defined in ACME and allowed by the CA/BF do not allow issuance of wildcard
          certificates. This new validation method incorporates the specially signed CSR (as defined by
          <span>[<a href="#cabf-br" class="cite xref">cabf-br</a>]</span> § B.2.b) into ACME to allow for the issuance of wildcard certificates.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">To this end a new challenge type called "onion-csr-01" is defined, with the following fields:<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.2-3">
          <dt id="section-3.2-3.1">type (required, string)</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-3.2">The string "onion-csr-01"<a href="#section-3.2-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-3.3">nonce (required, string)</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-3.4">A Base64 <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span> encoded nonce, including padding characters.
            It <span class="bcp14">MUST</span> contain at least 64 bits of entropy. It <span class="bcp14">MUST NOT</span> be valid for more
            than 30 days.<a href="#section-3.2-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-3.5">authKey (optional, object)</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-3.6">The Ed25519 public key encoded as per <span>[<a href="#RFC8037" class="cite xref">RFC8037</a>]</span>.<a href="#section-3.2-3.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<div class="lang-json sourcecode" id="section-3.2-4">
<pre>
{
  "type": "onion-csr-01",
  "url": "https://example.com/acme/chall/bbc625c5",
  "status": "pending",
  "nonce": "bI6/MRqV4gw=",
  "authKey": { ... }
}
</pre><a href="#section-3.2-4" class="pilcrow">¶</a>
</div>
<p id="section-3.2-5">Clients prove control over the key associated with the ".onion" service by generating a CSR with the
          following additional extension attributes and signing it with the private key of the ".onion" Special-Use
          Domain Name:<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-6.1">A caSigningNonce attribute containing the nonce provided in the challenge. This <span class="bcp14">MUST</span>
            be raw bytes, and not the base64 encoded value provided in the challenge object.<a href="#section-3.2-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-6.2">An applicantSigningNonce containing a nonce generated by the client. This <span class="bcp14">MUST</span> have at
            least 64 bits of entropy. This <span class="bcp14">MUST</span> be raw bytes.<a href="#section-3.2-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-7">These additional attributes have the following format<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<div class="lang-asn.1 sourcecode" id="section-3.2-8">
<pre>
cabf OBJECT IDENTIFIER ::=
  { joint-iso-itu-t(2) international-organizations(23)
    ca-browser-forum(140) }

cabf-caSigningNonce OBJECT IDENTIFIER ::= { cabf 41 }

caSigningNonce ATTRIBUTE ::= {
  WITH SYNTAX             OCTET STRING
  EQUALITY MATCHING RULE  octetStringMatch
  SINGLE VALUE            TRUE
  ID                      { cabf-caSigningNonce }
}

cabf-applicantSigningNonce OBJECT IDENTIFIER ::= { cabf 42 }

applicantSigningNonce ATTRIBUTE ::= {
  WITH SYNTAX             OCTET STRING
  EQUALITY MATCHING RULE  octetStringMatch
  SINGLE VALUE            TRUE
  ID                      { cabf-applicantSigningNonce }
}
</pre><a href="#section-3.2-8" class="pilcrow">¶</a>
</div>
<p id="section-3.2-9">The subject of the CSR need not be meaningful and CAs <span class="bcp14">SHOULD NOT</span> validate its contents.
          The public key presented in this CSR <span class="bcp14">MUST</span> be the public key corresponding to the ".onion"
          Special-Use Domain Name being validated. It <span class="bcp14">MUST NOT</span> be the same public key presented in the
          CSR to finalize the order.<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<p id="section-3.2-10">Client respond with the following object to validate the challenge<a href="#section-3.2-10" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.2-11">
          <dt id="section-3.2-11.1">csr (required, string)</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-11.2">
            The CSR in the base64url-encoded version of the DER format.
            (Note: Because this field uses base64url, and does not include headers, it is different from PEM.)<a href="#section-3.2-11.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<div class="lang-http sourcecode" id="section-3.2-12">
<pre>
POST example.com/acme/chall/bbc625c5
Host: example.com
Content-Type: application/jose+json

{
  "protected": base64url({
    "alg": "ES256",
    "kid": "https://example.com/acme/acct/evOfKhNU60wg",
    "nonce": "UQI1PoRi5OuXzxuX7V7wL0",
    "url": "https://example.com/acme/chall/bbc625c5"
  }),
  "payload": base64url({
    "csr": "MIIBPTCBxAIBADBFMQ...FS6aKdZeGsysoCo4H9P"
  }),
  "signature": "Q1bURgJoEslbD1c5...3pYdSMLio57mQNN4"
}
</pre><a href="#section-3.2-12" class="pilcrow">¶</a>
</div>
<p id="section-3.2-13">When presented with the CSR the server verifies it in the following manner:<a href="#section-3.2-13" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.2-14">
          <li id="section-3.2-14.1">The CSR is a well formatted PKCS#10 request.<a href="#section-3.2-14.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-14.2">The public key in the CSR corresponds to the ".onion" Special-Use Domain Name being validated.<a href="#section-3.2-14.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-14.3">The signature over the CSR validates with the ".onion" Special-Use Domain Name public key.<a href="#section-3.2-14.3" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-14.4">The caSigningNonce attribute is present and its contents matches the nonce provided to the client.<a href="#section-3.2-14.4" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-14.5">The applicantSigningNonce attribute is present and contains at least 64 bits of entropy.<a href="#section-3.2-14.5" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.2-15">If all of the above are successful then validation succeeds, otherwise it has failed.<a href="#section-3.2-15" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-4">
      <h2 id="name-client-authentication-to-hi">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-client-authentication-to-hi" class="section-name selfRef">Client authentication to hidden services</a>
      </h2>
<p id="section-4-1">Some hidden services do not wish to be accessible to the entire Tor network, and so encrypt their hidden
        service descriptor with the keys of clients authorized to connect. Without a way for the CA to signal what key
        it will use to connect these services will not be able to obtain a certificate using http-01 or tls-alpn-01,
        nor enforce CAA with any validation method.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">To this end, an additional field in the challenge object is defined to allow the ACME server to advertise the
        Ed25519 public key it will use (as per <span>[<a href="#tor-rend-spec-v3" class="cite xref">tor-rend-spec-v3</a>]</span> INTRO-AUTH) to authenticate itself when
        retrieving the hidden service descriptor.<a href="#section-4-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4-3">
        <dt id="section-4-3.1">authKey (optional, object)</dt>
        <dd style="margin-left: 1.5em" id="section-4-3.2">The Ed25519 public key encoded as per <span>[<a href="#RFC8037" class="cite xref">RFC8037</a>]</span>.<a href="#section-4-3.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-4-4">ACME servers <span class="bcp14">MUST NOT</span> use the same public key with multiple hidden services.
        ACME servers <span class="bcp14">MAY</span> re-use public keys for re-validation of the same hidden service.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">There is no method to communicate to the CA that client authentication is required; instead the ACME server
        <span class="bcp14">MUST</span> attempt to calculate its CLIENT-ID as per <span>[<a href="#tor-rend-spec-v3" class="cite xref">tor-rend-spec-v3</a>]</span> FIRST-LAYER-CLIENT-BEHAVIOR.
        If no "auth-client" line in the first layer hidden service descriptor matches the computed client-id then the server
        <span class="bcp14">MUST</span> assume that the hidden service does not require client authentication and proceed accordingly.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">In the case the Ed25519 public key is novel to the client it will have to resign and republish its hidden service
        descriptor. It <span class="bcp14">SHOULD</span> wait some (indeterminate) amount of time for the new descriptor to
        propagate the Tor hidden service directory servers, before proceeding with responding to the challenge.
        This should take no more than a few minutes. CAs <span class="bcp14">MUST NOT</span> expire challenges before a reasonable
        time to allow publication of the new descriptor (this document suggests at least 30 minutes).<a href="#section-4-6" class="pilcrow">¶</a></p>
</section>
<section id="section-5">
      <h2 id="name-acme-over-hidden-services">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-acme-over-hidden-services" class="section-name selfRef">ACME over hidden services</a>
      </h2>
<p id="section-5-1">A CA offering certificates to ".onion" Special-Use Domain Names <span class="bcp14">SHOULD</span> strongly consider
        making their ACME server available as a Tor hidden services. ACME clients <span class="bcp14">SHOULD</span> also support
        connecting to ACME servers over Tor, regardless of their support of "onion-csr-01", as their existing "http-01"
        and "tls-alpn-01" implementations could be used to obtain certificates for ".onion" Special-Use Domain Names.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6">
      <h2 id="name-certification-authority-aut">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-certification-authority-aut" class="section-name selfRef">Certification Authority Authorization (CAA)</a>
      </h2>
<p id="section-6-1">".onion" Special-Use Domain Name are not part of the DNS, and as such a variation on CAA <span>[<a href="#RFC8659" class="cite xref">RFC8659</a>]</span> is required
        to allow restrictions to be placed on certificate issuance.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">To this end a new field is added to the second layer hidden service descriptor
        <span>[<a href="#tor-rend-spec-v3" class="cite xref">tor-rend-spec-v3</a>]</span> § 2.5.2.2. with the following format:<a href="#section-6-2" class="pilcrow">¶</a></p>
<div class="sourcecode" id="section-6-3">
<pre>
"caa" SP flags SP tag SP value NL
[Any number of times]
</pre><a href="#section-6-3" class="pilcrow">¶</a>
</div>
<p id="section-6-4">The contents of "flag", "tag", and "value" are as per <span>[<a href="#RFC8659" class="cite xref">RFC8659</a>]</span> § 4.1.1. Multiple CAA records may
       be present, as is the case in the DNS. CAA records in a hidden service descriptor are to be treated the same by
       CAs as if they had been in the DNS for the ".onion" Special-Use Domain Name.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">A hidden service's second layer descriptor using CAA may look something like the following:<a href="#section-6-5" class="pilcrow">¶</a></p>
<div class="sourcecode" id="section-6-6">
<pre>
create2-formats 2
single-onion-service
caa 128 issue "test.acmeforonions.org;validationmethods=onion-csr-01"
caa 0 iodef "mailto:security@example.com"
introduction-point AwAGsAk5nSMpAhRqhMHbTFCTSlfhP8f5PqUhe6DatgMgk7kSL3KHCZUZ3C6tXDeRfM9SyNY0DlgbF8q+QSaGKCs=
...
</pre><a href="#section-6-6" class="pilcrow">¶</a>
</div>
<section id="section-6.1">
        <h3 id="name-relevant-resource-record-se">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-relevant-resource-record-se" class="section-name selfRef">Relevant Resource Record Set</a>
        </h3>
<p id="section-6.1-1">In the absence of the possibility for delegation of subdomains from a ".onion" Special-Use Domain Name as
          there is in the DNS there is no need, nor indeed any method available to search up the DNS tree for a relevant
          CAA record set. Similarly, it is also impossible to check CAA records on the "onion" Special-Use TLD, as it
          does not exist in any form except as described in <span>[<a href="#RFC7686" class="cite xref">RFC7686</a>]</span>, so implementors must not look here
          either.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Instead all subdomains under a ".onion" Special-Use Domain Name share the same CAA record set. That is all of
          these share a CAA record set with "a.onion":<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-3.1">b.a.onion<a href="#section-6.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-3.2">c.a.onion<a href="#section-6.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-3.3">e.d.a.onion<a href="#section-6.1-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.1-4">But these do not:<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-5.1">b.c.onion<a href="#section-6.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-5.2">c.d.onion<a href="#section-6.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-5.3">e.c.d.onion<a href="#section-6.1-5.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-6.2">
        <h3 id="name-when-to-check-caa">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-when-to-check-caa" class="section-name selfRef">When to check CAA</a>
        </h3>
<p id="section-6.2-1">If the hidden service has client authentication enabled then it will be impossible for the CAA to decrypt
          the second layer descriptor to read the CAA records until the CAAs public key has been added to first layer
          descriptor. To this end a CA <span class="bcp14">SHOULD</span> wait until the client responds to an authorization, and
          treat this as indication that their public key has been added and that the CA will be able to decrypt the
          second layer descriptor.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.3">
        <h3 id="name-preventing-mis-issuance-by-">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-preventing-mis-issuance-by-" class="section-name selfRef">Preventing mis-issuance by unknown CAs</a>
        </h3>
<p id="section-6.3-1">As the CAA records are in the second layer descriptor and in the case of a hidden service requiring client
          authentication it is impossible to read them without the hidden service trusting a CA's public key, a method is
          required to signal that there are CAA records present (but not reveal their contents, which may disclose
          unwanted information about the hidden service operator).<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">To this end a new field is added to the first layer hidden service descriptor
          <span>[<a href="#tor-rend-spec-v3" class="cite xref">tor-rend-spec-v3</a>]</span> § 2.5.1.2. with the following format:<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<div class="sourcecode" id="section-6.3-3">
<pre>
"caa-critical" NL
[At most once]
</pre><a href="#section-6.3-3" class="pilcrow">¶</a>
</div>
<p id="section-6.3-4">If a CA encounters this flag it <span class="bcp14">MUST NOT</span> proceed with issuance until it can decrypt and
          parse the CAA records from the second layer descriptor.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
</section>
<section id="section-6.4">
        <h3 id="name-alternative-in-band-present">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-alternative-in-band-present" class="section-name selfRef">Alternative in-band presentation of CAA</a>
        </h3>
<p id="section-6.4-1">A CA may not be willing to operate the infrastructure required to fetch, decode, and verify Tor hidden service
          descriptors in order to check CAA records. Tor directory servers are inherently untrusted entities, and as such
          there is no difference in the security model of accepting CAA records directly from the ACME client or fetching
          them over Tor. To this end a method to signal CAA policies in-band of ACME is defined.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">If a hidden service does use this method to provide CAA records to a CA it <span class="bcp14">SHOULD</span> still publish
          CAA records if its CAA record set includes "iodef", "contactemail", or "contactphone" so that this information
          is still publicly accessible. A hidden service operator <span class="bcp14">MAY</span> also not wish to publish a CAA
          record set in its service descriptor to avoid revealing information about the service operator.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">A new field is defined in the ACME finalize endpoint to contain the hidden service's CAA record set
          If a CA receives a validly signed CAA record set in the finalize request it need not check the CAA set in
          the hidden service descriptor and can proceed with issuance on the basis of the client provided CAA record set
          only. A CA, however, is not required to do anything with the client provided record set, and is free to always
          fetch the record set from the service descriptor.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.4-4">
          <dt id="section-6.4-4.1">onionCAA (optional, object)</dt>
          <dd style="margin-left: 1.5em" id="section-6.4-4.2">
            The CAA record set defined below.<a href="#section-6.4-4.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.4-5">The contents of the "onionCAA" object is:<a href="#section-6.4-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.4-6">
          <dt id="section-6.4-6.1">caa (required, string or null)</dt>
          <dd style="margin-left: 1.5em" id="section-6.4-6.2">
            The CAA record set as a string, encoded in the same way as if was included in the hidden service descriptor.
            If the hidden service does not have a CAA record set then this <span class="bcp14">MUST</span> be null.<a href="#section-6.4-6.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.4-6.3">expiry (required, integer)</dt>
          <dd style="margin-left: 1.5em" id="section-6.4-6.4">
            The Unix timestamp at which this CAA record set will expire. This <span class="bcp14">SHOULD NOT</span> be more than
            8 hours in the future. CAs <span class="bcp14">MUST</span> process this as at least a 64-bit integer to ensure
            functionality beyond 2038.<a href="#section-6.4-6.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-6.4-6.5">signature (required, string)</dt>
          <dd style="margin-left: 1.5em" id="section-6.4-6.6">
            The Ed25519 signature of the CAA record set using the private key corresponding to the ".onion"
            Special-Use Domain Name, encoded using base64url. The signature is defined below.<a href="#section-6.4-6.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.4-7">The data that the signature is calculated over is the concatenation of the following:<a href="#section-6.4-7" class="pilcrow">¶</a></p>
<div class="sourcecode" id="section-6.4-8">
<pre>"onion-caa|" || expiry || "|" || caa</pre><a href="#section-6.4-8" class="pilcrow">¶</a>
</div>
<p id="section-6.4-9">Where "|" is the ASCII character 0x7C, and expiry is the expiry field as a decimal string with no
          leading zeros.<a href="#section-6.4-9" class="pilcrow">¶</a></p>
<section id="section-6.4.1">
          <h4 id="name-cas-requiring-in-band-caa">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-cas-requiring-in-band-caa" class="section-name selfRef">CAs requiring in-band CAA</a>
          </h4>
<p id="section-6.4.1-1">If a CA does not support fetching a service's CAA record set from its service descriptor it, and the
            ACME client does not provide an "onionCAA" object in its finalize request the CA <span class="bcp14">MUST</span> respond
            with an "onionCAARequired" error to indicate this.<a href="#section-6.4.1-1" class="pilcrow">¶</a></p>
<p id="section-6.4.1-2">Additionally, a new field is defined in the directory "meta" object to signal this.<a href="#section-6.4.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.4.1-3">
            <dt id="section-6.4.1-3.1">onionCAARequired (optional, boolean)</dt>
            <dd style="margin-left: 1.5em" id="section-6.4.1-3.2">
              If true, the CA requires the client to provide the CAA record set in the finalize request.
              If false or absent the CA does not require the client to provide the CAA record set is this manner.<a href="#section-6.4.1-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-6.4.1-4">A directory of such a CA may look like<a href="#section-6.4.1-4" class="pilcrow">¶</a></p>
<div class="lang-http sourcecode" id="section-6.4.1-5">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "newNonce": "https://example.com/acme/new-nonce",
  "newAccount": "https://example.com/acme/new-account",
  "newOrder": "https://example.com/acme/new-order",
  "revokeCert": "https://example.com/acme/revoke-cert",
  "keyChange": "https://example.com/acme/key-change",
  "meta": {
    "termsOfService": "https://example.com/acme/terms/2023-10-13",
    "website": "https://acmeforonions.org/",
    "caaIdentities": ["test.acmeforonions.org"],
    "onionCAARequired": true
  }
}
</pre><a href="#section-6.4.1-5" class="pilcrow">¶</a>
</div>
</section>
<section id="section-6.4.2">
          <h4 id="name-example-in-band-caa">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-example-in-band-caa" class="section-name selfRef">Example in-band CAA</a>
          </h4>
<p id="section-6.4.2-1">Given the following example CAA record set for 5anebu2glyc235wbbop3m2ukzlaptpkq333vdtdvcjpigyb7x2i2m2qd.onion:<a href="#section-6.4.2-1" class="pilcrow">¶</a></p>
<div class="sourcecode" id="section-6.4.2-2">
<pre>
caa 128 issue "test.acmeforonions.org; validationmethods=onion-csr-01"
caa 0 iodef "mailto:example@example.com"
</pre><a href="#section-6.4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-6.4.2-3">The following would be submitted to the CA's finalize endpoint<a href="#section-6.4.2-3" class="pilcrow">¶</a></p>
<div class="lang-http sourcecode" id="section-6.4.2-4">
<pre>
POST /acme/order/TOlocE8rfgo/finalize
Host: example.com
Content-Type: application/jose+json

{
  "protected": base64url({
    "alg": "ES256",
    "kid": "https://example.com/acme/acct/evOfKhNU60wg",
    "nonce": "MSF2j2nawWHPxxkE3ZJtKQ",
    "url": "https://example.com/acme/order/TOlocE8rfgo/finalize"
  }),
  "payload": base64url({
    "csr": "MIIBPTCBxAIBADBFMQ...FS6aKdZeGsysoCo4H9P",
    "onionCAA": {
      "caa": "caa 128 issue \"test.acmeforonions.org; validationmethods=onion-csr-01\"\ncaa 0 iodef \"mailto:example@example.com\"",
      "expiry": 1697210719,
      "signature": "u_iP6JZ4JZBrzQUKH6lSrWejjRfeQmkTuehc0_FaaTNPAV0RVxpUz9r44DRdy6kgy0ofnx18KIhMrP7N1wpxAA=="
    }
  }),
  "signature": "uOrUfIIk5RyQ...nw62Ay1cl6AB"
}
</pre><a href="#section-6.4.2-4" class="pilcrow">¶</a>
</div>
</section>
</section>
</section>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-validation-methods">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-validation-methods" class="section-name selfRef">Validation Methods</a>
        </h3>
<p id="section-7.1-1">Per this document, one new entry has been added to the "ACME Validation Methods" registry defined in
          <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §9.7.8. This entry is defined below:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<span id="name-new-entries"></span><table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-new-entries" class="selfRef">New entries</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Label</th>
              <th class="text-left" rowspan="1" colspan="1">Identifier Type</th>
              <th class="text-left" rowspan="1" colspan="1">ACME</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">onion-csr-01</td>
              <td class="text-left" rowspan="1" colspan="1">dns</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
          </tbody>
        </table>
</section>
<section id="section-7.2">
        <h3 id="name-error-types">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-error-types" class="section-name selfRef">Error Types</a>
        </h3>
<p id="section-7.2-1">Per this document, one new entry has been added to the "ACME Error Types" registry defined in
          <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §9.7.8. This entry is defined below:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<span id="name-new-entries-2"></span><table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-new-entries-2" class="selfRef">New entries</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">onionCAARequired</td>
              <td class="text-left" rowspan="1" colspan="1">The CA only supports checking CAA for hidden services in-band, but the client has not provided an
                in-band CAA</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
          </tbody>
        </table>
</section>
<section id="section-7.3">
        <h3 id="name-directory-metadata-fields">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-directory-metadata-fields" class="section-name selfRef">Directory Metadata Fields</a>
        </h3>
<p id="section-7.3-1">Per this document, one new entry has been added to the "ACME Directory Metadata Fields" registry defined in
          <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §9.7.8. This entry is defined below:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<span id="name-new-entries-3"></span><table class="center" id="table-3">
          <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-new-entries-3" class="selfRef">New entries</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Field name</th>
              <th class="text-left" rowspan="1" colspan="1">Field type</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">onionCAARequired</td>
              <td class="text-left" rowspan="1" colspan="1">boolean</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
          </tbody>
        </table>
</section>
</section>
</div>
<div id="Security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="security-id-dns">
<section id="section-8.1">
        <h3 id="name-use-of-dns-identifier-type">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-use-of-dns-identifier-type" class="section-name selfRef">Use of "dns" identifier type</a>
        </h3>
<p id="section-8.1-1">The re-use of the "dns" identifier type for a Special-Use Domain Name not actually in the DNS infrastructure
          raises questions regarding its suitability. The reasons the author wishes to pursue this path in the first
          place are detailed in <a href="#use-of-id-dns" class="auto internal xref">Appendix A</a>. It is felt that there is little security concern in
          reuse of the "dns" identifier type with regards the mis-issuance by CAs that are not aware of ".onion"
          Special-Use Domain Names, as CAs would not be able to resolve the identifier in the DNS.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<section id="section-8.1.1">
          <h4 id="name-http-01-challenge">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-http-01-challenge" class="section-name selfRef">"http-01" Challenge</a>
          </h4>
<p id="section-8.1.1-1">The CA would follow the procedure set out in <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §8.3 which specifies that the CA
            should "Dereference the URL using an HTTP GET request". Given that ".onion" Special-Use Domain Names require
            special handling to dereference, this de-referencing will fail, disallowing issuance.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.1.2">
          <h4 id="name-tls-alpn-01-challenge">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-tls-alpn-01-challenge" class="section-name selfRef">"tls-alpn-01" Challenge</a>
          </h4>
<p id="section-8.1.2-1">The CA would follow the procedure set out in <span>[<a href="#RFC8737" class="cite xref">RFC8737</a>]</span> §3 which specifies that the CA
            "resolves the domain name being validated and chooses one of the IP addresses returned for validation".
            Given that ".onion" Special-Use Domain Names are not resolvable to IP addresses, this de-referencing will
            fail, disallowing issuance.<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.1.3">
          <h4 id="name-dns-01-challenge">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-dns-01-challenge" class="section-name selfRef">"dns-01" Challenge</a>
          </h4>
<p id="section-8.1.3-1">The CA would follow the procedure set out in <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §8.4 which specifies that the CA
            should "query for TXT records for the validation domain name".
            Given that ".onion" Special-Use Domain Names are not present in the DNS infrastructure, this query will
            fail, disallowing issuance.<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<section id="section-8.2">
        <h3 id="name-key-authorization-with-onio">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-key-authorization-with-onio" class="section-name selfRef">Key Authorization with "onion-csr-01"</a>
        </h3>
<p id="section-8.2-1">The "onion-csr-01" challenge does not make use of the key authorization string defined in
          <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> §8.1. This does not weaken the integrity of authorizations.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">The key authorization exists to ensure that whilst an attacker observing the validation channel may observe
          the correct validation response, they cannot compromise the integrity of authorizations as the response
          can only be used with the account key for which it was generated. As the validation channel for this challenge
          is ACME itself, and ACME already requires that the request be signed by the account, the key authorization is
          not required.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
<section id="section-8.3">
        <h3 id="name-use-of-tor-for-non-onion-do">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-use-of-tor-for-non-onion-do" class="section-name selfRef">Use of Tor for non ".onion" domains</a>
        </h3>
<p id="section-8.3-1">An ACME server <span class="bcp14">MUST NOT</span> utilise Tor for the validation of non ".onion" domains, due to the
          risk of possible exit hijacking.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.4">
        <h3 id="name-security-of-caa-records">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-security-of-caa-records" class="section-name selfRef">Security of CAA records</a>
        </h3>
<p id="section-8.4-1">The second layer descriptor is signed, encrypted and MACed in a way that only a party with access to the
          secret key of the hidden service could manipulate what is published there. For more information about this
          process see <span>[<a href="#tor-rend-spec-v3" class="cite xref">tor-rend-spec-v3</a>]</span> § 2.5.3.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.5">
        <h3 id="name-access-of-the-tor-network">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-access-of-the-tor-network" class="section-name selfRef">Access of the Tor network</a>
        </h3>
<p id="section-8.5-1">The ACME server <span class="bcp14">MUST</span> make its own connection to the hidden service via the Tor network,
          and <span class="bcp14">MUST NOT</span> outsource this, such as by using Tor2Web.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-8.6">
        <h3 id="name-anonymity-of-the-acme-clien">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-anonymity-of-the-acme-clien" class="section-name selfRef">Anonymity of the ACME client</a>
        </h3>
<p id="section-8.6-1">ACME clients requesting certificates for ".onion" Special-Use Domain Names may expose the existence of a
        hidden service on the host to unintended parties - even when features such as ECH
          <span>[<a href="#I-D.ietf-tls-esni" class="cite xref">I-D.ietf-tls-esni</a>]</span> are utilised, as the IP addresses of ACME servers are generally
          well-known, static, and not used for any other purpose.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">ACME clients <span class="bcp14">SHOULD</span> connect to ACME servers over the Tor network to alleviate this, preferring
        a hidden service endpoint if the CA provides such a service.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="BCP14">[BCP14]</dt>
        <dd>
<div class="refInstance" id="RFC2119">
            <span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>. </div>
<div class="refInstance" id="RFC8174">
            <span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>. </div>
<span>&lt;<a href="https://www.rfc-editor.org/info/bcp14">https://www.rfc-editor.org/info/bcp14</a>&gt;</span>
</dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7686">[RFC7686]</dt>
        <dd>
<span class="refAuthor">Appelbaum, J.</span> and <span class="refAuthor">A. Muffett</span>, <span class="refTitle">"The ".onion" Special-Use Domain Name"</span>, <span class="seriesInfo">RFC 7686</span>, <span class="seriesInfo">DOI 10.17487/RFC7686</span>, <time datetime="2015-10" class="refDate">October 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7686">https://www.rfc-editor.org/info/rfc7686</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8037">[RFC8037]</dt>
        <dd>
<span class="refAuthor">Liusvaara, I.</span>, <span class="refTitle">"CFRG Elliptic Curve Diffie-Hellman (ECDH) and Signatures in JSON Object Signing and Encryption (JOSE)"</span>, <span class="seriesInfo">RFC 8037</span>, <span class="seriesInfo">DOI 10.17487/RFC8037</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8037">https://www.rfc-editor.org/info/rfc8037</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8555">[RFC8555]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Hoffman-Andrews, J.</span>, <span class="refAuthor">McCarney, D.</span>, and <span class="refAuthor">J. Kasten</span>, <span class="refTitle">"Automatic Certificate Management Environment (ACME)"</span>, <span class="seriesInfo">RFC 8555</span>, <span class="seriesInfo">DOI 10.17487/RFC8555</span>, <time datetime="2019-03" class="refDate">March 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8555">https://www.rfc-editor.org/info/rfc8555</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8659">[RFC8659]</dt>
        <dd>
<span class="refAuthor">Hallam-Baker, P.</span>, <span class="refAuthor">Stradling, R.</span>, and <span class="refAuthor">J. Hoffman-Andrews</span>, <span class="refTitle">"DNS Certification Authority Authorization (CAA) Resource Record"</span>, <span class="seriesInfo">RFC 8659</span>, <span class="seriesInfo">DOI 10.17487/RFC8659</span>, <time datetime="2019-11" class="refDate">November 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8659">https://www.rfc-editor.org/info/rfc8659</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8737">[RFC8737]</dt>
        <dd>
<span class="refAuthor">Shoemaker, R.B.</span>, <span class="refTitle">"Automated Certificate Management Environment (ACME) TLS Application-Layer Protocol Negotiation (ALPN) Challenge Extension"</span>, <span class="seriesInfo">RFC 8737</span>, <span class="seriesInfo">DOI 10.17487/RFC8737</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8737">https://www.rfc-editor.org/info/rfc8737</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="tor-address-spec">[tor-address-spec]</dt>
        <dd>
<span class="refAuthor">Nick Mathewson, N.</span>, <span class="refTitle">"Special Hostnames in Tor"</span>, <span>&lt;<a href="https://spec.torproject.org/address-spec">https://spec.torproject.org/address-spec</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="tor-rend-spec-v3">[tor-rend-spec-v3]</dt>
        <dd>
<span class="refAuthor">The Tor Project</span>, <span class="refTitle">"Tor Rendezvous Specification - Version 3"</span>, <span>&lt;<a href="https://spec.torproject.org/rend-spec-v3">https://spec.torproject.org/rend-spec-v3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="cabf-br">[cabf-br]</dt>
      <dd>
<span class="refAuthor">CA/Browser Forum</span>, <span class="refTitle">"Baseline Requirements for the Issuance and Management of Publicly-Trusted Certificates"</span>, <span>&lt;<a href="https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.8.6.pdf">https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.8.6.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="onion-services-setup">[onion-services-setup]</dt>
        <dd>
<span class="refAuthor">The Tor Project</span>, <span class="refTitle">"Set Up Your Onion Service"</span>, <span>&lt;<a href="https://community.torproject.org/onion-services/setup/">https://community.torproject.org/onion-services/setup/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-esni">[I-D.ietf-tls-esni]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Oku, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"TLS Encrypted Client Hello"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-esni-17</span>, <time datetime="2023-10-09" class="refDate">9 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-17">https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni-17</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="use-of-id-dns">
<section id="appendix-A">
      <h2 id="name-discussion-on-the-use-of-th">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-discussion-on-the-use-of-th" class="section-name selfRef">Discussion on the use of the "dns" identifier type</a>
      </h2>
<p id="appendix-A-1">The reasons for utilising the "dns" identifier type in ACME and not defining a new identifier type for
        ".onion" s may not seem obvious at first glance. After all, ".onion" Special-Use Domain
        Names are not part of the DNS infrastructure and as such why should they use the "dns" identifier type?<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">The CA/Browser Forum Baseline Requirements <span>[<a href="#cabf-br" class="cite xref">cabf-br</a>]</span> §B.2.a.ii define, and this standard allows,
        using the "http-01" or "tls-alpn-01" validation methods already present in ACME (with some considerations).
        Given the situation of a web server placed behind a Tor terminating proxy (as per the setup suggested by the
        Tor project <span>[<a href="#onion-services-setup" class="cite xref">onion-services-setup</a>]</span>), existing ACME tooling can be blind to the fact that a
        ".onion" Special-Use Domain Name is being utilised, as they simply receive an incoming TCP connection as they
        would regardless (albeit from the Tor terminating proxy).<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">An example of this would be Certbot placing the ACME challenge response file in the webroot of an NGINX web
        server. Neither Certbot nor NGINX would require any modification to be aware of any special handling for
        ".onion" Special-Use Domain Names.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">This does raise some questions regarding security within existing implementations, however the authors believe
        this is of little concern, as per <a href="#security-id-dns" class="auto internal xref">Section 8.1</a>.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Acknowledgements">
<section id="appendix-B">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-B-1">With thanks to the Open Technology Fund for funding the work that went into this document.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">The authors also wish to thank the following for their input on this document:<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-3.1">Iain R. Learmonth<a href="#appendix-B-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-3.2">Jan-Frederik Rieckers<a href="#appendix-B-3.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Q Misell (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">AS207960 Cyfyngedig</span></div>
<div dir="auto" class="left"><span class="street-address">13 Pen-y-lan Terrace</span></div>
<div dir="auto" class="left"><span class="locality">Caerdydd</span></div>
<div dir="auto" class="left"><span class="postal-code">CF23 9EU</span></div>
<div dir="auto" class="left"><span class="country-name">United Kingdom</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:q@as207970.net" class="email">q@as207970.net</a>, <a href="mailto:q@magicalcodewit.ch" class="email">q@magicalcodewit.ch</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://magicalcodewit.ch" class="url">https://magicalcodewit.ch</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
